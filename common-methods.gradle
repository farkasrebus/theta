def getCommitId() {
    def commit = new ByteArrayOutputStream()
    def branch = new ByteArrayOutputStream()
    exec {
        commandLine 'git', 'rev-parse', '--short', 'HEAD'
        standardOutput = commit
    }
    exec {
        commandLine 'git', 'rev-parse', '--abbrev-ref', 'HEAD'
        standardOutput = branch
    }
    def id = branch.toString() + "-" + commit.toString()

    return id.replace("\n", "").replaceAll("[^a-zA-Z0-9._]", "-")
}

def createJarTask(def taskName, def mainClass, def jarBaseName) {
    return tasks.create(taskName, Jar) {
    	manifest {
        attributes 'Implementation-Version': getCommitId(),
        	'Main-Class': mainClass
	    }
	    baseName = jarBaseName
	    classifier = null
	    version = null
	    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
	    with jar	    
    }
}

ext {
	getCommitId = this.&getCommitId
	createJarTask = this.&createJarTask
}